doi <- doi_list$DOI[i]
doi
dsn <- doi_df[which(doi_df==doi, arr.ind = TRUE)[1.1],1]
doi_list$Author[i] <- strsplit(doi, "[,]")[[1]][1]
strsplit(doi, "[,]")[[1]][1]
i=668
dsn <- doi_df[which(doi_df==doi, arr.ind = TRUE)[1.1],1]
strsplit(doi, "[,]")[[1]][1]
dsn <- doi_df[which(doi_df==doi, arr.ind = TRUE)[1.1],1]
#
doi <- doi_list$DOI[i]
strsplit(doi, "[,]")[[1]][1]
strsplit(doi, "[.,]")[[1]][1]
i=696
#
doi <- doi_list$DOI[i]
strsplit(doi, "[.,]")[[1]][1]
doi
#Create empty table
doi_list <- data.frame('DOI'=sort(unique(unlist(doi_df[3:ncol(doi_df)]))))
doi_list$references <- doi_list$Author <- doi_list$Year <- NA
pb <- txtProgressBar(min=0,max = nrow(doi_list), style = 3)
#Get references from DOIs
for (i in 604:nrow(doi_list)){
#Progress bar
Sys.sleep(0.1)
setTxtProgressBar(pb, i)
#
doi <- doi_list$DOI[i]
if (substr(doi,1,4)=="http"){doi<-sub(".*org/", "", doi)}
#if (doi ){doi<-NA}
if (substr(doi,1,3) %in% c("10.","htt") & grepl('10.',doi)){
ref <- cr_cn(doi, format="bibentry")
doi_list$references[i] <- cr_cn(doi, format="text", style=style)
doi_list$Author[i] <- ref$author
doi_list$Year[i]   <- as.numeric(ref$year)
}else{
dsn <- doi_df[which(doi_df==doi, arr.ind = TRUE)[1.1],1]
if(length(D_hc[[dsn]]$pub)>0){
for (p in 1:length(D_hc[[dsn]]$pub)){
if (doi == D_hc[[dsn]]$pub[[p]]$doi){
if(!is.null(D_hc[[dsn]]$pub[[p]]$author[[1]]$name)){
doi_list$Author[i] <- D_hc[[dsn]]$pub[[p]]$author[[1]]$name
} else{
doi_list$Author[i] <- strsplit(doi, "[.,]")[[1]][1]
}
doi_list$Year[i] <- as.numeric(D_hc[[dsn]]$pub[[p]]$year)
}
}
}else{print(paste('NO REF INFO FOR DATASET',dsn))}
doi_list$references[i] <- doi
}
# Add author and years for sorting
if(!is.na(doi_list$references[i])){
}
}
View(doi_list)
i=614
i=613
#
doi <- doi_list$DOI[i]
doi
dsn <- doi_df[which(doi_df==doi, arr.ind = TRUE)[1.1],1]
length(D_hc[[dsn]]$pub)>0
for (p in 1:length(D_hc[[dsn]]$pub)){
print(p)}
doi == D_hc[[dsn]]$pub[[p]]$doi
D_hc[[dsn]]$pub[[p]]$doi
doi
dsn
ds
dsn
strsplit(doi, ".")[[1]][1]
strsplit(dsn, ".")[[1]][1]
strsplit(dsn, ".")[[1]]
dsn
strsplit(dsn, ".")
strsplit(dsn, ".")[[1]]
strsplit(dsn, '.')[[1]]
strsplit(dsn, '[.]')[[1]]
strsplit(dsn, '[.]')[[1]][-1]
strsplit(dsn, '[.]')[[1]]
tail(strsplit(dsn, '[.]')[[1]])
tail(strsplit(dsn, '[.]')[[1]],n=1)
as.numeric(tail(strsplit(dsn, '[.]')[[1]],n=1))
#Create empty table
doi_list <- data.frame('DOI'=sort(unique(unlist(doi_df[3:ncol(doi_df)]))))
doi_list$references <- doi_list$Author <- doi_list$Year <- NA
pb <- txtProgressBar(min=0,max = nrow(doi_list), style = 3)
#Get references from DOIs
for (i in 1:nrow(doi_list)){
#Progress bar
Sys.sleep(0.1)
setTxtProgressBar(pb, i)
#
doi <- doi_list$DOI[i]
if (substr(doi,1,4)=="http"){doi<-sub(".*org/", "", doi)}
#if (doi ){doi<-NA}
if (substr(doi,1,3) %in% c("10.","htt") & grepl('10.',doi)){
ref <- cr_cn(doi, format="bibentry")
doi_list$references[i] <- cr_cn(doi, format="text", style=style)
doi_list$Author[i] <- ref$author
doi_list$Year[i]   <- as.numeric(ref$year)
}else{
dsn <- doi_df[which(doi_df==doi, arr.ind = TRUE)[1.1],1]
if(length(D_hc[[dsn]]$pub)>0){
for (p in 1:length(D_hc[[dsn]]$pub)){
if (doi == D_hc[[dsn]]$pub[[p]]$doi){
if(!is.null(D_hc[[dsn]]$pub[[p]]$author[[1]]$name)){
doi_list$Author[i] <- D_hc[[dsn]]$pub[[p]]$author[[1]]$name
} else{
doi_list$Author[i] <- strsplit(doi, "[.,]")[[1]][1]
}
doi_list$Year[i] <- as.numeric(D_hc[[dsn]]$pub[[p]]$year)
} else{
doi_list$Author[i] <- strsplit(doi, "[.,]")[[1]][1]
doi_list$Year[i] <- tail(strsplit(dsn, '[.]')[[1]],n=1)
}
}
}else{print(paste('NO REF INFO FOR DATASET',dsn))}
doi_list$references[i] <- doi
}
# Add author and years for sorting
if(!is.na(doi_list$references[i])){
}
}
View(doi_list)
#List of references
doi_list <- doi_list %>% arrange(Author, Year)
outDir <- file.path(wd,'Data','Proxy','References')
#List of references
doi_list <- doi_list %>% arrange(Author, Year)
write.csv(doi_list[,c('references')], file.path(outDir,paste0("LiPD_referencesList_",var,".csv")))
#Create New DF to output
doi_df_out <- doi_df
for (r in 1:nrow(doi_df_out)){
for (c in 3:ncol(doi_df_out)){
if(!is.na(doi_df_out[r,c])){
doi_df_out[r,c] <- which(doi_list$DOI == doi_df[r,c])
} else{
if (c == 3){
doi_df_out[r,c] <- 'noPubOnRecord'
} else{
doi_df_out[r,c] <- ''
}
}
}
}
write.csv(doi_df_out, file.path(outDir,paste0("LiPD_referencesKey_",var,".csv")))                 # Apply writeLines function
#Write text file with count for each references
references <- doi_list$references
for (i in 1:length(references)){
references[[i]] <- paste0(i,'. ',references[[i]])
}
writeLines(references, file.path(outDir,paste0("LiPD_referencesList_",var,".txt")))                 # Apply writeLines function
doi_df_out
write.csv(doi_df, file.path(outDir,paste0("LiPD_referencesKey_",var,".csv")))                 # Apply writeLines function
write.csv(doi_df_out, file.path(outDir,paste0("LiPD_referencesKey_",var,".csv")))                 # Apply writeLines function
write.csv(doi_list, file.path(outDir,paste0("LiPD_referencesList_",var,".csv")))
cr_cn("10.1177/0959683612471983")
cr_cn("10.1016/j.quascirev.2007.11.012")
cr_cn("10.1038/ncomms4805 (2014)")
cr_cn("10.1038/ncomms4805")
cr_cn("10.1029/2009GL042196")
cr_cn("10.1017/qua.2018.151")
cr_cn("10.1130/0016-7606(1973)84<3663:PIOSPL>2.0.CO;2")
cr_cn("10.1016/0033-5894(85)90075-4")
cr_cn("10.1016/j.yqres.2005.10.007")
cr_cn("10.1890/0012-9658(2006)87%5B1722:WCCOSF%5D2.0.CO;2")
cr_cn("10.1890/0012-9658(2006)87[1722:wccosf]2.0.co;2")
cr_cn("10.1890/0012-9658(2006)87[1722:wccosf]2.0.co;2",'text')
cr_cn("10.1890/0012-9658(2006)87%5B1722:WCCOSF%5D2.0.CO;2",'text',style='AGU')
cr_cn("10.1890/0012-9658(2006)87[1722:wccosf]2.0.co;2",'text',style='AGU')
cr_cn("10.1890/0012-9658(2006)87[1722:wccosf]2.0.co;2",'text',style=style)
cr_cn("10.1890/0012-9658(2006)87%5B1722:WCCOSF%5D2.0.CO;2",'text',style=style)
cr_cn("10.1017/qua.2018.151",'text',style=style)
cr_cn("10.1002/2015WR017850",'text',style=style)
cr_cn("10.1016/S0277-3791(01)00048-8",'text',style=style)
cr_cn("10.5194/essd-2022-38",'text',style=style)
cr_cn("10.1016/j.quascirev.2009.07.007",'text',style=style)
cr_cn("10.1016/j.yqres.2014.01.012",'text',style=style)
cr_cn("10.1016/j.quascirev.2009.07.007",'text',style=style)
cr_cn("10.1002/jqs.1484",'text',style=style)
cr_cn("https://doi.org/10.1002/jqs.1484",'text',style=style)
cr_cn("10.1016/j.quascirev.2003.06.014",'text',style=style)
cr_cn("110.5194/cp-10-1605-2014",'text',style=style)
cr_cn("10.5194/cp-10-1605-2014",'text',style=style)
cr_cn("110.1029/2022GL099772",'text',style=style)
cr_cn("10.5194/cp-10-1605-2014",'text',style=style)
cr_cn("10.1029/2022GL099772",'text',style=style)
cr_cn("10.1016/S0009-2541(00)00299-0",'text',style=style)
cr_cn("10.1016/j.epsl.2004.10.024",'text',style=style)
cr_cn("https://doi.pangaea.de/10.1594/PANGAEA.327243",'text',style=style)
cr_cn("https://doi.org/10.1594/PANGAEA.858559",'text',style=style)
cr_cn("10.1016/0031-0182(92)90115-L",'bibentry',style=style)
z<-cr_cn("10.1016/0031-0182(92)90115-L",'bibentry',style=style)
data.frame(author=c(z$author))
names(z)
df<-data.frame(year=c(z$year),
author=c(z$author),
journal=c(z$journal),
pages=c(z$pages),
number=c(z$number),
volume=c(z$volume)
)
View(df)
z<-cr_cn("10.1016/0031-0182(92)90115-L",'bibentry',style=style)
df<-data.frame(year=c(z$year),
title=c(z$title)
author=c(z$author),
df<-data.frame(year=c(z$year),
title=c(z$title)
author=c(z$author),
df<-data.frame(year=c(z$year),
title=c(z$title),
author=c(z$author),
journal=c(z$journal),
pages=c(z$pages),
number=c(z$number),
volume=c(z$volume)
)
df
View(df)
source("~/.active-rstudio-document", echo=TRUE)
source("~/.active-rstudio-document", echo=TRUE)
dois<-c("10.1177/0959683612471983",
"10.1177/0959683612471983",
"10.1177/0959683612471983",
"10.1016/j.epsl.2004.10.024",
"10.1038/s41598-017-15566-4",
"10.1029/2018JD029699",
"10.1016/j.quascirev.2011.04.011",
"10.1038/NGEO2329",
"10.1130/g22103.1",
"10.1029/2008GL034971",
"10.1126/science.1233797",
"10.5194/cp-8-1751-2012",
"10.5194/cp-2017-146",
"10.5194/cp-2017-146",
"10.1016/j.quaint.2007.09.039",
"10.1126/science.1059725",
"10.1017/qua.2018.151",
"10.1038/s41598-018-35498-x",
"10.1038/s41598-018-35498-x",
"10.1016/j.palaeo.2011.02.030",
"10.1016/j.epsl.2004.10.024",
"10.1007/s10933-012-9638-x",
"10.1038/srep24745",
"10.1038/srep24745",
"10.1016/j.yqres.2010.09.002",
"10.1038/ncomms2415",
"10.1016/j.epsl.2008.07.060",
"10.1177/0959683619838021",
"10.1016/j.palaeo.2013.02.030",
"10.1016/j.palaeo.2013.02.030",
"10.1177/0959683612471986",
"10.1016/j.yqres.2011.01.006",
"10.1016/j.quascirev.2013.09.001",
"10.1029/2012gm001203",
"10.1016/j.quaint.2007.09.039",
"10.1126/science.1091220",
"10.1126/science.1091220",
"10.1016/j.epsl.2012.11.019",
"10.1016/j.quascirev.2017.08.012",
"10.1016/S0277-3791(01)00048-8",
"10.1038/ncomms2415",
"10.1038/ncomms2415",
"10.1016/j.quascirev.2018.05.025",
"10.2113/gsrocky.49.1.33",
"10.1016/j.quascirev.2013.06.019",
"10.1016/j.gca.2011.04.003",
"10.1016/j.epsl.2019.01.045",
"10.1029/2005JD006810",
"10.1038/s41598-018-35498-x",
"10.1038/nature06164",
"10.7202/033027ar",
"10.1016/j.epsl.2007.10.015",
"10.1016/j.quascirev.2009.03.003",
"10.1130/g31827.1",
"10.1007/s11430-006-0615-y",
"10.1016/j.quascirev.2013.01.016",
"10.1016/j.quascirev.2013.01.016",
"10.1016/j.quascirev.2013.01.016",
"10.1016/j.quascirev.2013.01.016",
"10.1016/j.quascirev.2013.05.008
"10.1038/srep44267",
dois<-c("10.1177/0959683612471983",
dois<-c("10.1177/0959683612471983",
"10.1177/0959683612471983",
"10.1177/0959683612471983",
"10.1016/j.epsl.2004.10.024",
"10.1038/s41598-017-15566-4",
"10.1029/2018JD029699",
"10.1016/j.quascirev.2011.04.011",
"10.1038/NGEO2329",
"10.1130/g22103.1",
"10.1029/2008GL034971",
"10.1126/science.1233797",
"10.5194/cp-8-1751-2012",
"10.5194/cp-2017-146",
"10.5194/cp-2017-146",
"10.1016/j.quaint.2007.09.039",
"10.1126/science.1059725",
"10.1017/qua.2018.151",
"10.1038/s41598-018-35498-x",
"10.1038/s41598-018-35498-x",
"10.1016/j.palaeo.2011.02.030",
"10.1016/j.epsl.2004.10.024",
"10.1007/s10933-012-9638-x",
"10.1038/srep24745",
"10.1038/srep24745",
"10.1016/j.yqres.2010.09.002",
"10.1038/ncomms2415",
"10.1016/j.epsl.2008.07.060",
"10.1177/0959683619838021",
"10.1016/j.palaeo.2013.02.030",
"10.1016/j.palaeo.2013.02.030",
"10.1177/0959683612471986",
"10.1016/j.yqres.2011.01.006",
"10.1016/j.quascirev.2013.09.001",
"10.1029/2012gm001203",
"10.1016/j.quaint.2007.09.039",
"10.1126/science.1091220",
"10.1126/science.1091220",
"10.1016/j.epsl.2012.11.019",
"10.1016/j.quascirev.2017.08.012",
"10.1016/S0277-3791(01)00048-8",
"10.1038/ncomms2415",
"10.1038/ncomms2415",
"10.1016/j.quascirev.2018.05.025",
"10.2113/gsrocky.49.1.33",
"10.1016/j.quascirev.2013.06.019",
"10.1016/j.gca.2011.04.003",
"10.1016/j.epsl.2019.01.045",
"10.1029/2005JD006810",
"10.1038/s41598-018-35498-x",
"10.1038/nature06164",
"10.7202/033027ar",
"10.1016/j.epsl.2007.10.015",
"10.1016/j.quascirev.2009.03.003",
"10.1130/g31827.1",
"10.1007/s11430-006-0615-y",
"10.1016/j.quascirev.2013.01.016",
"10.1016/j.quascirev.2013.01.016",
"10.1016/j.quascirev.2013.01.016",
"10.1016/j.quascirev.2013.01.016",
"10.1016/j.quascirev.2013.05.008",
"10.1038/srep44267",
"10.1002/2015gl065397",
"10.1016/j.epsl.2009.12.039",
"10.1016/j.quascirev.2012.04.013",
"10.1038/srep36975",
"10.1016/j.quascirev.2013.08.004",
"10.1080/11035890809453231",
"10.20944/preprints201809.0380.v1",
"10.1111/j.1502-3885.1993.tb00159.x",
"10.1016/S0031-0182(02)00710-1",
"10.1191/0959683605hl815rp",
"10.1016/0033-5894(89)90027-6",
"10.1006/qres.1998.2005",
"10.1016/j.yqres.2014.01.012",
"10.1016/S0277-3791(01)00048-8",
"10.1016/0033-5894(79)90034-6",
"10.1130/g32098.1",
"10.1038/ncomms4805",
"10.1038/ncomms11719",
"10.1016/j.epsl.2008.08.018",
"10.1016/j.palaeo.2019.109252",
"10.1126/science.203.4381.609",
"10.1016/j.yqres.2014.01.012",
"10.1016/j.palaeo.2016.07.007",
"10.1016/j.palaeo.2016.07.007",
"10.1006/qres.1999.2120",
"10.1191/0959683605hl889rp",
"10.1029/2012gm001207",
"10.1029/2012gm001207",
"10.1029/2012gm001207",
"10.1029/2012gm001207",
"10.1016/j.quaint.2013.03.018",
"10.1017/qua.2017.39",
"10.1016/j.quascirev.2012.02.011",
"10.1016/j.quascirev.2015.07.006",
"10.1038/ncomms2222",
"10.1038/nature20787",
"10.1130/G22865A.1",
"10.1016/S0277-3791(01)00048-8",
"10.1016/j.quaint.2013.05.005",
"10.1016/j.quascirev.2015.05.003",
"10.1007/BF02901169",
"10.1016/j.quascirev.2020.106444",
"10.1016/j.quascirev.2006.04.012",
"10.1016/j.quascirev.2017.08.012",
"10.1038/ngeo444",
"10.1038/ngeo444",
"10.1139/b69-243",
"10.1007/BF00682431",
"10.1111/j.1502-3885.2011.00220.x",
"10.1038/ncomms7309",
"10.1016/j.quascirev.2016.05.023",
"10.1007/s11434-011-4848-6",
"10.1130/0-8137-2368-X.79",
"10.1016/j.palaeo.2017.10.021",
"10.1177/0959683614534741",
"10.1016/j.yqres.2008.08.005",
"10.1890/11-1068.1",
"10.1016/j.quaint.2013.05.005",
"10.1016/j.epsl.2017.01.034",
"10.1016/j.quaint.2007.09.039",
"10.1130/g30306.1",
"10.1038/srep36975",
"10.1007/BF00196779",
"10.1016/j.quascirev.2005.11.014",
"10.1177/0959683616652711",
"10.1016/j.yqres.2015.07.004",
"10.1016/0031-0182(91)90147-J",
"10.1016/j.epsl.2004.10.024",
"10.1016/j.quascirev.2011.04.011",
"10.1016/j.epsl.2017.11.044",
"10.1073/pnas.1424035112",
"10.1007/s11430-007-0059-z",
"10.1007/s11430-010-0025-z",
"10.1016/j.yqres.2016.05.001")
df[1,]
dois[[1]]
for (i in 1:length(dois)){
for (i in 1:length(dois)){
for (i in 1:length(dois)){
z<-cr_cn(dois[[i]],'bibentry',style=style)
df[1,]<-data.frame(year=c(z$year),
title=c(z$title),
author=c(z$author),
journal=c(z$journal),
pages=c(z$pages),
number=c(z$number),
volume=c(z$volume))
}
View(df)
rep(NA,length(dois))
df<-data.frame(year=rep(NA,length(dois)),
title=rep(NA,length(dois)),
author=rep(NA,length(dois)),
journal=rep(NA,length(dois)),
pages=rep(NA,length(dois)),
number=rep(NA,length(dois)),
volume=rep(NA,length(dois))
)
for (i in 1:length(dois)){
z<-cr_cn(dois[[i]],'bibentry',style=style)
df[1,]<-data.frame(year=c(z$year),
title=c(z$title),
author=c(z$author),
journal=c(z$journal),
pages=c(z$pages),
number=c(z$number),
volume=c(z$volume))
}
z
df[1,]
data.frame(year=c(z$year),
title=c(z$title),
author=c(z$author),
journal=c(z$journal),
pages=c(z$pages),
number=c(z$number),
volume=c(z$volume))
z$year
z$title
z$author
z$journal
z$pages
z$number
z$volume
df[i,'year']
z[['year']]
df<-data.frame(year=rep(NA,length(dois)),
title=rep(NA,length(dois)),
author=rep(NA,length(dois)),
journal=rep(NA,length(dois)),
pages=rep(NA,length(dois)),
number=rep(NA,length(dois)),
volume=rep(NA,length(dois))
)
for (i in 1:length(dois)){
df
for (i in 1:length(dois)){
z<-cr_cn(dois[[i]],'bibentry',style=style)
for (name in c('year','title','author','journal','pages','number','volume'))
if(!is.null(z[[name]])){df[i,name] <- z[[name]]}
}
View(Df)
View(df)
for (i in 87:length(dois)){
z<-cr_cn(dois[[i]],'bibentry',style=style)
for (name in c('year','title','author','journal','pages','number','volume'))
if(!is.null(z[[name]])){df[i,name] <- z[[name]]}
}
View(df)
df$doi<- dois
read.csv("/Users/chrishancock/Downloads/text.csv")
write.csv("/Users/chrishancock/Downloads/text.csv")
write.csv(df,"/Users/chrishancock/Downloads/text.csv")
cr_cn("10.1006/qres.1999.2120")
cr_cn("10.1006/qres.1999.2120",'bibentry')
cr_cn("10.5194/cp-2017-146",'bibentry')
cr_cn("10.1029/2012gm001203",'bibentry')
cr_cn("10.1130/0-8137-2368-X.79",'bibentry')
View(df$number)
View(df[,'number)
View(df[,'number)
View(df[,'number'])
View(df[:,'number'])
View(data.frame(df[,'number']))
