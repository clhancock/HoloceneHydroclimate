---
title: "dynamicMap"
author: "ChrisHancock"
date: "9/14/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#devtools::install_github("rstudio/leaflet#346")
```


```{r setup, include=FALSE}
library(ggplot2)
library(leaflet)
library(plotly)
library(plotly)
library(crosstalk)
dir  <- getwd()# '/Volumes/GoogleDrive/My Drive/zResearch/Manuscript/HoloceneHydroclimate/HoloceneHydroclimate' #

#nc <- sf::st_read(system.file("shape/nc.shp", package = "sf"), quiet = TRUE)
#bscols(map, DT::datatable(ncsd))


PROJ <- '+proj=robin   +ellps=WGS84 +datum=WGS84 +no_defs +lon_0=0 +x_0=0 +y_0=0 +units=m'
PROJorig <- "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
load(url('https://github.com/SantanderMetGroup/ATLAS/blob/main/reference-regions/IPCC-WGI-reference-regions-v4_R.rda?raw=true'), verbose = TRUE)
refregions <-  spTransform(IPCC_WGI_reference_regions_v4, CRSobj = PROJ)
ncsd <- highlight_key(sf::st_as_sf(refregions))

map <- plot_ly(ncsd, split = ~Name,color = I("gray"), hoveron = "fills") %>%
  highlight(persistent = TRUE, color = "red", opacityDim = 1) %>%
  layout(title = "Click on counties to query them", showlegend = FALSE) %>%
  config(displayModeBar = FALSE)
```


```{r setup, include=FALSE}
ncsd <- highlight_key(sf::st_as_sf(refregions))
newTable <- DT::datatable(ncsd)
replaceTable <- newTable[["x"]][["data"]][,c('Acronym','Name')]
names(replaceTable) <- c('Acronym','Composite')
replaceTable$Acronym <- as.character(replaceTable$Acronym)
#replaceTable$Composite <-sprintf('![](https://raw.githack.com/clhancock/HoloceneHydroclimate/main/Figures/RegionComposites/HC/59_NZ_Composite.png)')


newTable[["x"]][["data"]] <-replaceTable# knitr::kable(replaceTable)

z<- reactable(as.matrix(replaceTable),columns   = list(
    Composite= colDef(width=400,align = 'left', cell = function(value, index){
    knitr::kable(value)})))


bscols(map, newTable)

save_html(bscols(map, newTable),file.path(dir,"Figures","test.html") )# Produces HTML with external dependencies
#newTable
#newTable[["x"]][["data"]]
#reactable(replaceTable)
```















